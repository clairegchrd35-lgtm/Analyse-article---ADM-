---
title: "Analyse Metadata"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
metadata <- read.csv2("Metadata/SraRunTable.csv",header = TRUE,sep =",")
```

```{r}
library(phyloseq); packageVersion("phyloseq")
```
```{r}
library(Biostrings); packageVersion("Biostrings")
```

```{r}
library(ggplot2); packageVersion("ggplot2")
```
```{r}
theme_set(theme_bw())
```

```{r}
samples.out <- rownames(seqtab.nochim)
subject <- sapply(strsplit(samples.out, "D"), `[`, 1)
gender <- substr(subject,1,1)
subject <- substr(subject,2,999)
day <- as.integer(sapply(strsplit(samples.out, "D"), `[`, 2))
samdf <- data.frame(Subject=subject, Gender=gender, Day=day)
samdf$When <- "Early"
samdf$When[samdf$Day>100] <- "Late"
rownames(samdf) <- samples.out
```

```{r}
ps <- phyloseq(otu_table(seqtab.nochim, taxa_are_rows=FALSE), 
               sample_data(samdf), 
               tax_table(taxa))
ps <- prune_samples(sample_names(ps) != "Mock", ps) # Remove mock sample
```

```{r}
dna <- Biostrings::DNAStringSet(taxa_names(ps))
names(dna) <- taxa_names(ps)
ps <- merge_phyloseq(ps, dna)
taxa_names(ps) <- paste0("ASV", seq(ntaxa(ps)))
ps
```
```{r}
sample_data(ps)
```

```{r}
plot_richness(ps, x="Subject", measures=c("Shannon", "Simpson"), color="When")
```
```{r}
library(phyloseq)

# Supprimer échantillons vides
ps.nonzero <- prune_samples(sample_sums(ps) > 0, ps)

# Supprimer OTUs absentes dans tous les échantillons
ps.nonzero <- prune_taxa(taxa_sums(ps.nonzero) > 0, ps.nonzero)

# Transformer en proportions
ps.prop <- transform_sample_counts(ps.nonzero, function(x) x / sum(x))

# Ordination NMDS Bray-Curtis
ord.nmds.bray <- ordinate(ps.prop, method="NMDS", distance="bray")

```

```{r}
plot_ordination(ps.prop, ord.nmds.bray, color="When", title="Bray NMDS")
```



 


